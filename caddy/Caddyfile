{
  # Server Options
  servers {
    timeouts {
      read_body 1h
      read_header 1h
      write 1h
      idle 5m
    }
  }
}
:4000
handle /marketplace* {
  # handle path not working
  uri strip_prefix /marketplace
  reverse_proxy https://app-digmkt-${ENV}.apps.silver.devops.gov.bc.ca {
    header_up Host {http.reverse_proxy.upstream.host}
    flush_interval -1
  }
}

handle /* {
  # for app
  root * /opt/app-root/src
  file_server 
  encode gzip

  try_files {path} {path}/ /index.html

  header / {
    # prevent any static html from being cached
    Cache-Control "public, max-age=0, must-revalidate"
  }
}

log {
  output stderr
  output stdout 
  format single_field common_log
  level info
}  